---
layout: post
title:  "UCOSⅡ事件"
date:   2020-9-9 21:20:00
categories: UCOSII
tags: 嵌入式 c 实时操作系统 ucosII
excerpt: 关于UCOSII中信号量机制的使用。
mathjax: true
---

# UC/OSⅡ的信号量机制

## 一、 概述

uC/OSⅡ中的信号量采用记录型信号量，当获取不到资源时任务会进入阻塞队列（或使用非阻塞函数返回自行处理）。

## 二、 具体函数解析

1. `OSSemAccept()` :此函数检查信号量以查看资源是否可用或者事件是否发生。与`OSSemPend()` 不同，`OSSemAccept()`不会在资源不可用或事件未发生时挂起调用此函数的任务。换言之，该函数是用于检测资源是否可用或事件是否发生的**非阻塞函数**。

   ### 参数

   | 参数   | 类型       | 含义                  |
   | ------ | ---------- | --------------------- |
   | pevent | OS_EVENT * | 指向待检查的ECB的指针 |

   ### 返回值

   类型为 `INT16U`

   | 返回值 | 含义                                                        |
   | ------ | ----------------------------------------------------------- |
   | >0     | 资源可用或事件发生，信号量减少以占用资源                    |
   | ==0    | 资源不可用或事件未发生；或者是参数不是指向信号量ECB的指针。 |

2. `OSSemCreate()` :此函数用于**创建**一个信号量。传入的参数用于表示信号量的初始值，通常是资源的总量。

   ### 参数

   | 参数 | 类型   | 含义             |
   | ---- | ------ | ---------------- |
   | cnt  | INT16U | 信号量的初始化值 |

   ### 返回值

   类型为 `OS_EVENT *` 

   | 返回值 | 含义                                    |
   | ------ | --------------------------------------- |
   | !=NULL | 指向创建好的信号量的ECB的指针。         |
   | ==NULL | 没有可用的ECB（达到系统事件数量上限）。 |

3. `OSSemDel()` ：**删除**一个信号量。并将该信号量阻塞的待处理的任务移入就绪队列。

   ### 参数

   | 参数   | 类型       | 含义                                                         |
   | ------ | ---------- | ------------------------------------------------------------ |
   | pevent | OS_EVENT * | 指向待删除的信号量的ECB的指针。                              |
   | opt    | INT8U      | 决定哪些情况可以删除信号量：<br />1. opt == OS_DEL_NO_PEND ，仅当无任务阻塞时删除。<br />2. opt == OS_DEL_ALWAYS，删除信号量，如果有任务正在阻塞等待，将任务加入就绪队列。 |
   | err    | INT8U *    | 指向错误代码的指针。函数返回后，通过该指针可以获取错误代码。<br />1. OS_NO_ERR 信号量成功删除<br />2. OS_ERR_DEL_ISR 从中断中删除信号量<br />3. OS_ERR_INVALID_OPT 选项无效<br />4. OS_ERR_TASK_WAITING 当前有任务阻塞<br />5. OS_ERR_EVENT_TYPE 指针不是一个信号量的ECB<br />6. OS_ERR_PEVENT_NULL 空指针异常 |

   ### 返回值

   类型为 `OS_EVENT *` 

   | 返回值          | 含义                                    |
   | --------------- | --------------------------------------- |
   | 原pevent指针    | 出现错误，需要通过err指针检查错误类型。 |
   | ==(OS_EVENT *)0 | 信号量成功删除。                        |

4. `OSSemPend()`:请求获取信号量资源（阻塞函数）。如果资源不可用则任务会被**阻塞**。

   ### 参数

   | 参数    | 类型       | 含义                                                         |
   | ------- | ---------- | ------------------------------------------------------------ |
   | pevent  | OS_EVENT * | 请求获取的资源的信号量                                       |
   | timeout | INT16U     | 任务的最长等待周期（单位：tick）。如果该值被设置为0，则任务会一直等待到资源可用或事件发生（❗警惕死锁） |
   | err     | INT8U *    | 指向错误代码的指针。函数返回后，通过该指针可以获取错误代码。<br />1. OS_NO_ERR 调用成功，任务获取到资源<br />2. OS_TIMEOUT 阻塞超时，任务未获取到资源<br />3. OS_ERR_PEND_ISR 在中断中调用函数并导致挂起<br />4. OS_ERR_EVENT_TYPE 指针不是一个信号量的ECB<br />5. OS_ERR_PEVENT_NULL 空指针异常 |

   ### 返回值

   void

5. 